<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ - ÙƒØ±Ù…</title>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;800&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="styles/design-system.css">
    <link rel="stylesheet" href="styles/main.css">
    <link rel="stylesheet" href="styles/auth.css">
</head>

<body>
    <div class="auth-container">
        <div class="auth-side">
            <div class="auth-box">
                <div class="auth-logo">
                    <a href="index.html"><img src="assets/logo.png" alt="ÙƒØ±Ù…"></a>
                </div>
                <div class="auth-header">
                    <h1 class="auth-title">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ø¹ÙˆØ¯ØªÙƒ</h1>
                    <p class="auth-subtitle">Ø³Ø¬Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø­Ø³Ø§Ø¨Ùƒ</p>
                </div>

                <form id="login-form" class="auth-form">
                    <div class="form-group">
                        <label class="form-label">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
                        <input type="email" id="email" class="form-input" placeholder="example@email.com" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                        <input type="password" id="password" class="form-input" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" required>
                    </div>

                    <div class="form-row">
                        <label class="checkbox-label">
                            <input type="checkbox" id="remember-me">
                            <span>ØªØ°ÙƒØ±Ù†ÙŠ</span>
                        </label>
                        <a href="#" class="link-text">Ù†Ø³ÙŠØª ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±ØŸ</a>
                    </div>

                    <button type="submit" class="btn btn-primary btn-block btn-lg" id="login-btn">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>

                    <a href="visitor-dashboard.html" class="btn btn-secondary btn-block btn-lg"
                        style="margin-top: 10px; text-decoration: none;">
                        ğŸ  Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ø¥Ù„Ù‰ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
                    </a>
                </form>

                <div class="divider"><span>Ø£Ùˆ</span></div>

                <div class="auth-links">
                    <p class="text-center text-muted">Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ØŸ</p>
                    <div class="register-options">
                        <a href="visitor-register.html" class="btn btn-outline btn-sm">ØªØ³Ø¬ÙŠÙ„ ÙƒÙ…Ø¹ØªÙ…Ø±</a>
                        <a href="family-register.html" class="btn btn-outline btn-sm">ØªØ³Ø¬ÙŠÙ„ ÙƒØ£Ø³Ø±Ø©</a>
                        <a href="company-register.html" class="btn btn-outline btn-sm">ØªØ³Ø¬ÙŠÙ„ ÙƒØ´Ø±ÙƒØ©</a>
                    </div>
                </div>

                <div class="auth-footer">
                    <a href="index.html" class="link-secondary">â† Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
                </div>
            </div>
        </div>

        <div class="info-side">
            <div class="info-content">
                <div class="info-pattern"></div>
                <div class="info-text">
                    <div class="info-icon">ğŸ¤</div>
                    <h2 class="info-title">Ù†ØµÙ„ Ø¶ÙŠÙˆÙ Ø§Ù„Ø±Ø­Ù…Ù†<br>Ø¨Ø£Ù‡Ù„ Ø§Ù„ÙƒØ±Ù…</h2>
                    <p class="info-description">Ù…Ù†ØµØ© ÙƒØ±Ù… ØªØ±Ø¨Ø· Ø§Ù„Ù…Ø¹ØªÙ…Ø±ÙŠÙ† Ø¨Ø§Ù„Ø£Ø³Ø± Ø§Ù„Ù…ÙƒÙŠØ© ÙˆØ§Ù„Ù…Ø¯Ù†ÙŠØ©</p>
                    <div class="info-features">
                        <div class="info-feature">
                            <div class="feature-icon-sm">âœ“</div><span>Ø¶ÙŠØ§ÙØ© Ø£ØµÙŠÙ„Ø©</span>
                        </div>
                        <div class="info-feature">
                            <div class="feature-icon-sm">âœ“</div><span>ØªØµÙˆÙŠØ± Ø§Ø­ØªØ±Ø§ÙÙŠ</span>
                        </div>
                        <div class="info-feature">
                            <div class="feature-icon-sm">âœ“</div><span>ØªØ¬Ø±Ø¨Ø© Ù„Ø§ ØªÙÙ†Ø³Ù‰</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="toast-container"></div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        const SUPABASE_URL = 'https://mdkhvsvkqlhtikhpkwkf.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1ka2h2c3ZrcWxodGlraHBrd2tmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjUyNTM1NTAsImV4cCI6MjA4MDgyOTU1MH0.zabhAeKeIVAU8YTKmOHcEJf0vYCKJUrS9-RgkRg14ZY';
        function showToast(t, m, ty) { var c = document.getElementById('toast-container'), d = document.createElement('div'); d.className = 'toast ' + ty; d.innerHTML = '<div class="toast-content"><div class="toast-title">' + t + '</div><p>' + m + '</p></div>'; c.appendChild(d); setTimeout(function () { d.remove() }, 5000) }
        document.getElementById('login-form').addEventListener('submit', async function (e) {
            e.preventDefault();
            var btn = document.getElementById('login-btn'), email = document.getElementById('email').value, password = document.getElementById('password').value;
            btn.disabled = true; btn.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¯Ø®ÙˆÙ„...';
            try {
                if (window.supabase) {
                    var supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY), result = await supabase.auth.signInWithPassword({ email: email, password: password });
                    if (result.error) throw result.error;
                    localStorage.setItem('karam_user', JSON.stringify(result.data.user));
                    showToast('Ù†Ø¬Ø­', 'ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„!', 'success');
                    var role = result.data.user.user_metadata && result.data.user.user_metadata.role || 'umrah_visitor';
                    console.log('Role:', role);
                    window.location.replace(role === 'host_family' ? 'family-dashboard.html' : role === 'company' ? 'company-dashboard.html' : role === 'admin' || role === 'operator' ? 'operator-dashboard.html' : 'visitor-dashboard.html');
                } else {
                    await new Promise(function (r) { setTimeout(r, 1000) });
                    localStorage.setItem('karam_user', JSON.stringify({ email: email, user_type: 'umrah_visitor' }));
                    showToast('Ù†Ø¬Ø­', 'ØªÙ… Ø§Ù„Ø¯Ø®ÙˆÙ„ (ØªØ¬Ø±ÙŠØ¨ÙŠ)!', 'success');
                    window.location.replace('visitor-dashboard.html');
                }
            } catch (error) {
                console.error(error);
                showToast('Ø®Ø·Ø£', error.message || 'ÙØ´Ù„ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„', 'error');
                btn.disabled = false; btn.textContent = 'ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„';
            }
        });
    </script>
</body>

</html>