# โ ุชุฏูู ุงูุญุฌุฒ ุงููุงูู - Complete Booking Flow

## ๐ ูุธุฑุฉ ุนุงูุฉ

ููุตุฉ ูุฑู ุงูุขู ููุญุฏูุซุฉ ุจุงููุงูู ูุฌุงูุฒุฉ ููุงุณุชุฎุฏุงู ูุน ุฌุฏูู `booking_time_slots`!

---

## ๐ ุงูุชุฏูู ุงููุงูู

### 1๏ธโฃ ุงุณุชุนุฑุงุถ ุงูุฃุณุฑ (Browse Families)
**ุงูุตูุญุฉ:** `browse-families-calendar.html`

**ููู ุชุนูู:**
1. ุงููุณุชุฎุฏู ูุฎุชุงุฑ ุงูุชุงุฑูุฎ ูู ุงููุงูููุฏุฑ
2. ูุฎุชุงุฑ ูุชุฑุฉ ุฒูููุฉ (ุตุจุงุญุงูุ ุธูุฑุงูุ ูุณุงุกูุ ูููุงู)
3. ูุฎุชุงุฑ ุนุฏุฏ ุงูุถููู
4. ูุถุบุท "ุจุญุซ"

**ูุง ูุญุฏุซ ูู ุงูููุฏ:**
```javascript
// ูู browse-calendar.js
const { data, error } = await supabase
    .rpc('get_available_families', {
        p_date: selectedDate,        // '2025-12-15'
        p_start_time: slot.start,    // '14:00'
        p_end_time: slot.end,        // '18:00'
        p_guest_count: guestCount    // 5
    });
```

**ูุง ูุญุฏุซ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช:**
- ุชูููุฐ ุฏุงูุฉ `get_available_families()`
- ุชุญุณุจ ุงูุฃุณุฑ ุงููุญุฌูุฒุฉ ูู `booking_time_slots`
- ุชูุฑุฌุน ุงูุฃุณุฑ ุงููุชุงุญุฉ ููุท

---

### 2๏ธโฃ ุฅุถุงูุฉ ููุณูุฉ (Add to Cart)
**ูุง ููุญูุธ:**
```javascript
{
    familyId: "uuid-here",
    familyName: "ุฃุณุฑุฉ ุงููุฑู",
    date: "2025-12-15",
    timeSlot: "afternoon",
    startTime: "14:00",    // โญ ููู
    endTime: "18:00",      // โญ ููู
    guestCount: 5,
    price: 750
}
```

---

### 3๏ธโฃ ุตูุญุฉ ุงูุฏูุน (Checkout)
**ุงูุตูุญุฉ:** `checkout.html`

**ุงูุฎุทูุงุช:**
1. ุฅุฏุฎุงู ุจูุงูุงุช ุงูุนููู
2. ุฅุฏุฎุงู ุฃุณูุงุก ุฌููุน ุงูุฒูุงุฑ (ุนุฑุจู ุฃู ุฅูุฌููุฒู)
3. ุฅุถุงูุฉ ููุฏ ุฎุตู (ุงุฎุชูุงุฑู)
4. ุฑูู ุงูุทูุงุฑุฆ
5. ุงูุฏูุน

**ูุง ูุญุฏุซ ูู ุงูููุฏ:**
```javascript
// 1. ุฅูุดุงุก ุงูุญุฌุฒ
const { data: booking } = await supabase
    .from('bookings')
    .insert({
        booking_number: 'BK-xxx',
        visitor_id: user.id,
        family_id: cartItem.familyId,
        total_amount: cartItem.price,
        visitor_names: ['ูุญูุฏ ุฃุญูุฏ ุนูู', 'John Smith Doe'],
        discount_code_id: discountId,
        discount_amount: 100,
        emergency_contact: '0501234567'
    });

// 2. ุญูุธ ุงูููุช ูู booking_time_slots โญ
await supabase
    .from('booking_time_slots')
    .insert({
        booking_id: booking.id,
        booking_date: '20 25-12-15',
        start_time: '14:00',
        end_time: '18:00',
        guest_count: 5,
        status: 'confirmed'
    });
```

---

## ๐๏ธ ุงูุจูุงูุงุช ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

### ุฌุฏูู `bookings`:
```
id: uuid
booking_number: 'BK-xxx'
visitor_id: uuid
family_id: uuid
total_amount: 650.00 (ุจุนุฏ ุงูุฎุตู)
visitor_names: ["ูุญูุฏ ุฃุญูุฏ ุนูู ุงูุณุนูุฏ", "John Smith Doe"]
discount_code_id: uuid
discount_amount: 100.00
emergency_contact: '0501234567'
status: 'pending' โ 'confirmed' ุจุนุฏ ุงูุฏูุน
```

### ุฌุฏูู `booking_time_slots`:
```
id: uuid
booking_id: uuid (ูู bookings)
booking_date: '2025-12-15'
start_time: '14:00'
end_time: '18:00'
guest_count: 5
status: 'confirmed'
```

---

## ๐งช ููููุฉ ุงูุงุฎุชุจุงุฑ

### ุงูุฎุทูุฉ 1: ุงูุชุญ ุงููุชุตูุญ
```
http://localhost:8000/browse-families-calendar.html
```

### ุงูุฎุทูุฉ 2: ุงุฎุชุฑ ูุนุงููุฑ ุงูุจุญุซ
- ุงูุชุงุฑูุฎ: ุฃู ุชุงุฑูุฎ ูุณุชูุจูู
- ุงูููุช: ุงุฎุชุฑ ูุชุฑุฉ (ูุซูุงู: ุธูุฑุงู)
- ุงูุถููู: 5
- ุงููุฏููุฉ: ุงุฎุชูุงุฑู

### ุงูุฎุทูุฉ 3: ุฃุถู ุฃุณุฑุฉ ููุณูุฉ
- ุณุชุธูุฑ ุงูุฃุณุฑ ุงููุชุงุญุฉ
- ุงุถุบุท "ุฃุถู ููุณูุฉ" ุนูู ุฃุญุฏูุง

### ุงูุฎุทูุฉ 4: ุงุฐูุจ ููุฏูุน
- ุงุถุบุท "ุฅุชูุงู ุงูุญุฌุฒ"
- ุงููุฃ ุงูุจูุงูุงุช:
  - ุงูุงุณูุ ุงูุจุฑูุฏุ ุงูุฌูุงู
  - ุฃุณูุงุก ุงูุฒูุงุฑ (ุนุฑุจู ุฃู ุฅูุฌููุฒู)
  - ููุฏ ุฎุตู: `WELCOME20`
  - ุฑูู ุทูุงุฑุฆ

### ุงูุฎุทูุฉ 5: ุชุญูู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
```sql
-- ุขุฎุฑ ุญุฌุฒ
SELECT * FROM bookings 
ORDER BY created_at DESC 
LIMIT 1;

-- Time slots ุงูุฎุงุตุฉ ุจู
SELECT * FROM booking_time_slots
WHERE booking_id = 'BOOKING_ID_ูู_ุงูุงุณุชุนูุงู_ุงูุณุงุจู';
```

---

## โ Checklist ุงูุงุฎุชุจุงุฑ

- [ ] ูุชุญ ุตูุญุฉ ุงูุชุตูุญ ุจูุฌุงุญ
- [ ] ุงุฎุชูุงุฑ ุชุงุฑูุฎ ูููุช
- [ ] ุธููุฑ ุฃุณุฑ ูุชุงุญุฉ
- [ ] ุฅุถุงูุฉ ููุณูุฉ ูุนูู
- [ ] ุงูุณูุฉ ุชุญูุธ `startTime` ู `endTime`
- [ ] ุตูุญุฉ checkout ุชูุชุญ
- [ ] ุฅุฏุฎุงู ุฃุณูุงุก ุนุฑุจูุฉ ุชุนูู
- [ ] ุฅุฏุฎุงู ุฃุณูุงุก ุฅูุฌููุฒูุฉ ุชุนูู
- [ ] ุชุทุจูู ููุฏ ุฎุตู ูุนูู
- [ ] ุญูุธ ูู `bookings` ูุงุฌุญ
- [ ] ุญูุธ ูู `booking_time_slots` ูุงุฌุญ

---

## ๐ ุงููุดุงูู ุงููุญุชููุฉ ูุญููููุง

### 1. ูุง ุชุธูุฑ ุฃุณุฑ
**ุงูุณุจุจ:** ูุง ุชูุฌุฏ ุฃุณุฑ ููุงููุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

**ุงูุญู:**
```sql
-- ุชุญูู ูู ุงูุฃุณุฑ
SELECT id, family_name, status, is_active, capacity
FROM host_families;

-- ูุนูู ุฃุณุฑุฉ
UPDATE host_families
SET status = 'approved', is_active = true
WHERE id = 'FAMILY_UUID';
```

### 2. ุฎุทุฃ ุนูุฏ ุญูุธ ุงูุญุฌุฒ
**ุงูุณุจุจ:** ุฌุฏูู ` booking_time_slots` ุบูุฑ ููุฌูุฏ

**ุงูุญู:**
```sql
-- ุดุบูู:
database/karam_update_CLEAN.sql
```

### 3. ููุฏ ุงูุฎุตู ูุง ูุนูู
**ุงูุณุจุจ:** ุงูููุฏ ุบูุฑ ููุฌูุฏ

**ุงูุญู:**
```sql
INSERT INTO discount_codes (code, discount_type, discount_value, valid_until)
VALUES ('WELCOME20', 'percentage', 20, '2025-12-31');
```

---

## ๐ฏ ุงูููุฒุงุช ุงูุฌุงูุฒุฉ

โ ุชุตูุญ ุงูุฃุณุฑ ุญุณุจ ุงูุชุงุฑูุฎ ูุงูููุช
โ ุงูุญุฌูุฒุงุช ุงููุชุฒุงููุฉ (capacity tracking)
โ ุฃุณูุงุก ุงูุฒูุงุฑ (ุนุฑุจู/ุฅูุฌููุฒู)
โ ุฃููุงุฏ ุงูุฎุตู
โ ุฑูู ุงูุทูุงุฑุฆ
โ ุญูุธ Time Slots ูููุตู
โ ุงูุชุญูู ูู ุงูุณุนุฉ ุงููุชุจููุฉ

---

## ๐ ุฅุญุตุงุฆูุงุช ุงูุชูููุฐ

| ุงููููู | ุงูุญุงูุฉ |
|--------|---------|
| ูุงุนุฏุฉ ุงูุจูุงูุงุช | โ 100% |
| Browse Families | โ 100% |
| Checkout Flow | โ 100% |
| Discount Codes | โ 100% |
| Visitor Names | โ 100% |
| Time Slots | โ 100% |

---

**๐ ุงูููุตุฉ ุฌุงูุฒุฉ ููุงุณุชุฎุฏุงู ุงููุงูู!**

ุงุจุฏุฃ ุงูุงุฎุชุจุงุฑ ูู: `http://localhost:8000/browse-families-calendar.html`
